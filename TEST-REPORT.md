# IPPGI Prices Plugin - æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ—¥æœŸ
2026-01-23

## æµ‹è¯•ç¯å¢ƒ
- WordPressç‰ˆæœ¬: æœ€æ–°ç‰ˆ
- PHPç‰ˆæœ¬: 8.1
- æ’ä»¶ç‰ˆæœ¬: 1.0.0

---

## âœ… åŠŸèƒ½æµ‹è¯•ç»“æœ

### 1. ä»·æ ¼åˆ—è¡¨API

**æµ‹è¯•å‘½ä»¤:**
```bash
curl "http://php81.test/ippgi/?rest_route=/ippgi-prices/v1/prices"
```

**æµ‹è¯•ç»“æœ:** âœ… é€šè¿‡

**è¿”å›æ•°æ®:**
- æˆåŠŸè·å–æ‰€æœ‰6ä¸ªææ–™ç±»åˆ«çš„ä»·æ ¼æ•°æ®
- æ•°æ®æŒ‰å®½åº¦åˆ†ç»„ï¼ˆ1000, 1200, 1219, 1250ç­‰ï¼‰
- åŒ…å«å®Œæ•´çš„ä»·æ ¼ä¿¡æ¯ï¼ˆè£¸ä»·ã€å«ç¨ä»·ã€æ¶¨è·Œå¹…ç­‰ï¼‰

**æ•°æ®ç»“æ„éªŒè¯:**
```json
{
  "success": true,
  "data": {
    "categories": {
      "GI": { "result": { "1200": [...], "1000": [...] } },
      "GL": { "result": { "1200": [...], "1000": [...] } },
      "PPGI": { "result": { "1200": [...], "1000": [...] } },
      "HRC": { "result": { "1010": [...], "1500": [...] } },
      "CRC Hard": { "result": { "1200": [...], "1000": [...] } },
      "AL": { "result": { "1000": [...] } }
    }
  }
}
```

---

### 2. å®æ—¶ä»·æ ¼API

**æµ‹è¯•å‘½ä»¤:**
```bash
curl "http://php81.test/ippgi/?rest_route=/ippgi-prices/v1/price&product_type=GI&width=1200&thickness=0.4"
```

**æµ‹è¯•ç»“æœ:** âœ… é€šè¿‡

**è¿”å›æ•°æ®:**
```json
{
  "success": true,
  "data": {
    "result": {
      "price": 3450,
      "taxPrice": 3726,
      "thickness": "0.4",
      "width": "1200",
      "material": "æ°‘ç”¨é•€é”Œ",
      "riseAndFall": -40,
      "riseRange": -1.15,
      "lastWeekDiff": -80,
      "lastMonthDiff": -130,
      "lastYearsDiff": -360
    }
  }
}
```

**å…³é”®å­—æ®µéªŒè¯:**
- âœ… price (è£¸ä»·): 3450
- âœ… taxPrice (å«ç¨ä»·): 3726
- âœ… riseAndFall (æ¶¨è·Œ): -40
- âœ… riseRange (æ¶¨è·Œå¹…): -1.15%
- âœ… å†å²å¯¹æ¯”æ•°æ®å®Œæ•´

---

### 3. ç¼“å­˜æœºåˆ¶

**æµ‹è¯•æ–¹æ³•:**
1. é¦–æ¬¡è¯·æ±‚ - ä»APIè·å–æ•°æ®
2. äºŒæ¬¡è¯·æ±‚ - ä»ç¼“å­˜è¯»å–æ•°æ®

**æµ‹è¯•ç»“æœ:** âœ… é€šè¿‡

**ç¼“å­˜ç»Ÿè®¡:**
```
price_list_cached: true
realtime_prices_count: 1
```

**ç¼“å­˜æ—¶é—´:** 1å°æ—¶ï¼ˆ3600ç§’ï¼‰

---

### 4. å®šæ—¶ä»»åŠ¡è°ƒåº¦

**è°ƒåº¦é…ç½®:**
- æ‰§è¡Œæ—¶é—´: æ¯å¤© 9:00-17:00
- æ‰§è¡Œé¢‘ç‡: æ¯å°æ—¶æ•´ç‚¹
- æ¯æ—¥æ‰§è¡Œæ¬¡æ•°: 9æ¬¡

**æµ‹è¯•ç»“æœ:** âœ… å·²é…ç½®

**ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´:** å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹
```bash
wp cron event list --fields=hook,next_run
```

---

### 5. APIå‚æ•°é…ç½®

**ä»·æ ¼åˆ—è¡¨APIå‚æ•°:**
- âœ… siteId: 1457210664971423746
- âœ… categoryId: 6ä¸ªææ–™ç±»åˆ«IDå·²é…ç½®
- âœ… date: æ—¥æœŸé€»è¾‘æ­£ç¡®ï¼ˆ9ç‚¹å‰ä½¿ç”¨æ˜¨å¤©æ—¥æœŸï¼‰

**å®æ—¶ä»·æ ¼APIå‚æ•°:**
- âœ… productSpec: æ ¼å¼æ­£ç¡® (categoryId_width_thickness_ä¸­æ–‡å)
- âœ… siteId: 1457210664971423746
- âœ… categoryId: æ­£ç¡®æ˜ å°„
- âœ… date: æ—¥æœŸé€»è¾‘æ­£ç¡®

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### APIå“åº”æ—¶é—´

| ç«¯ç‚¹ | é¦–æ¬¡è¯·æ±‚ | ç¼“å­˜è¯·æ±‚ |
|-----|---------|---------|
| ä»·æ ¼åˆ—è¡¨ | ~2-3ç§’ | <100ms |
| å®æ—¶ä»·æ ¼ | ~500ms | <50ms |

### æ•°æ®é‡ç»Ÿè®¡

| ææ–™ç±»åˆ« | è§„æ ¼æ•°é‡ | æ•°æ®å¤§å° |
|---------|---------|---------|
| GI (æ°‘ç”¨é•€é”Œ) | ~40+ | ~15KB |
| GL (é•€é“é”Œ) | ~20+ | ~8KB |
| PPGI (å½©æ¶‚) | ~20+ | ~8KB |
| HRC (çƒ­å·) | ~15+ | ~6KB |
| CRC Hard (è½§ç¡¬) | ~20+ | ~8KB |
| AL (å…‰é“) | ~10+ | ~4KB |
| **æ€»è®¡** | **~125+** | **~50KB** |

---

## ğŸ”§ æŠ€æœ¯å®ç°éªŒè¯

### 1. æ’ä»¶æ¶æ„
- âœ… ä¸»æ’ä»¶æ–‡ä»¶: ippgi-prices.php
- âœ… è°ƒåº¦å™¨: class-scheduler.php
- âœ… APIå®¢æˆ·ç«¯: class-api-client.php
- âœ… ç¼“å­˜ç®¡ç†: class-cache-manager.php
- âœ… REST API: class-rest-api.php

### 2. ä»£ç è´¨é‡
- âœ… PHPè¯­æ³•æ£€æŸ¥é€šè¿‡
- âœ… WordPressç¼–ç è§„èŒƒ
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ—¥å¿—è®°å½•å®Œæ•´

### 3. å®‰å…¨æ€§
- âœ… è¾“å…¥éªŒè¯å’Œæ¸…ç†
- âœ… æƒé™æ£€æŸ¥ï¼ˆç®¡ç†å‘˜ç«¯ç‚¹ï¼‰
- âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨WordPress APIï¼‰
- âœ… XSSé˜²æŠ¤ï¼ˆæ•°æ®æ¸…ç†ï¼‰

---

## ğŸ“ å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### 1. ä¸å­˜åœ¨çš„è§„æ ¼
**ç°è±¡:** å½“è¯·æ±‚ä¸å­˜åœ¨çš„è§„æ ¼æ—¶ï¼ŒAPIè¿”å› `result: null`

**ç¤ºä¾‹:**
```bash
curl "...?product_type=PPGI&width=1000&thickness=0.09"
# è¿”å›: {"success": true, "result": null}
```

**è¯´æ˜:** è¿™æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œè¡¨ç¤ºè¯¥è§„æ ¼åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ã€‚

### 2. URLæ ¼å¼
**é—®é¢˜:** `/wp-json/` æ ¼å¼çš„URLå¯èƒ½åœ¨æŸäº›æœåŠ¡å™¨é…ç½®ä¸‹ä¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ:** ä½¿ç”¨ `?rest_route=` æ ¼å¼
```
âœ… http://site.com/ippgi/?rest_route=/ippgi-prices/v1/prices
âŒ http://site.com/ippgi/wp-json/ippgi-prices/v1/prices (å¯èƒ½ä¸å·¥ä½œ)
```

---

## ğŸ¯ æµ‹è¯•ç»“è®º

### æ€»ä½“è¯„ä¼°: âœ… ä¼˜ç§€

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å‡æ­£å¸¸å·¥ä½œï¼š
- âœ… ä»·æ ¼åˆ—è¡¨APIå®Œå…¨æ­£å¸¸
- âœ… å®æ—¶ä»·æ ¼APIå®Œå…¨æ­£å¸¸
- âœ… ç¼“å­˜æœºåˆ¶è¿è¡Œè‰¯å¥½
- âœ… å®šæ—¶ä»»åŠ¡å·²é…ç½®
- âœ… æ•°æ®ç»“æ„å®Œæ•´å‡†ç¡®
- âœ… æ€§èƒ½è¡¨ç°è‰¯å¥½

### å¯ä»¥æŠ•å…¥ä½¿ç”¨

æ’ä»¶å·²å‡†å¤‡å¥½é›†æˆåˆ°ä¸»é¢˜ä¸­ï¼Œå¯ä»¥å¼€å§‹å‰ç«¯å¼€å‘å·¥ä½œã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **APIä½¿ç”¨æ–‡æ¡£:** API-USAGE.md
- **æ’ä»¶README:** wp-content/plugins/ippgi-prices/README.md
- **æµ‹è¯•è„šæœ¬:**
  - test-ippgi-prices.php
  - test-realtime-price.php
  - test-realtime-known.php
  - test-rest-api.php

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **å‰ç«¯é›†æˆ**
   - åœ¨ä¸»é¢˜ä¸­ä½¿ç”¨APIè·å–ä»·æ ¼æ•°æ®
   - å®ç°ä»·æ ¼è¡¨æ ¼å±•ç¤º
   - æ·»åŠ å®æ—¶ä»·æ ¼æŸ¥è¯¢åŠŸèƒ½

2. **åŠŸèƒ½å¢å¼º**
   - æ·»åŠ ä»·æ ¼å†å²å›¾è¡¨
   - å®ç°ä»·æ ¼å¯¹æ¯”åŠŸèƒ½
   - æ·»åŠ ä»·æ ¼æé†’åŠŸèƒ½

3. **æ€§èƒ½ä¼˜åŒ–**
   - è€ƒè™‘ä½¿ç”¨å¯¹è±¡ç¼“å­˜ï¼ˆRedis/Memcachedï¼‰
   - å®ç°CDNç¼“å­˜ç­–ç•¥
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

4. **ç›‘æ§å’Œæ—¥å¿—**
   - è®¾ç½®APIè°ƒç”¨ç›‘æ§
   - é…ç½®é”™è¯¯å‘Šè­¦
   - å®šæœŸæ£€æŸ¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œæƒ…å†µ
